function initSearchPopup(popup,field,clearBtn){function open(){popup.velocity("fadeIn").data("opened",!0),$(document).on("click.searchPopup",function(e){$(e.target).closest(popup,field).length||close()})}function close(){popup.velocity("fadeOut").data("opened",!1),$(document).off("click.searchPopup")}field.on("focus keyup change",function(e){if(e.keyCode&&27===e.keyCode)return $(this).blur(),close(),void e.stopPropagation();$(this).val()?(clearBtn.show(),popup.data("opened")||open()):(clearBtn.hide(),close())}).on("click",function(e){e.stopImmediatePropagation()}),clearBtn.on("click",function(){field.val("").trigger("change")})}