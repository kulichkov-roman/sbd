b2.init.collectionHandle=function(){var target=$(".custom-collection-content>.items-wrap"),source=$(".items-to-choose-from>.items-wrap");if(target.length>0&&source.length>0){target.add(source).each(function(){var frame=$(this),$scrollbar=frame.children(".sly-scroll");frame.sly({horizontal:1,itemNav:"basic",dragSource:$(this).children(".slidee"),touchDragging:!0,elasticBounds:!0,scrollBar:$scrollbar,dragHandle:!0,dynamicHandle:!0,minHandleSize:30,clickBar:!0,syncSpeed:.5,interactive:".item",speed:300}).sly("on","load",function(){this.pos.start===this.pos.end?$scrollbar.hide():$scrollbar.show()}).sly("reload")}),target.on("mousedown","a",function(e){e.stopPropagation()}),source.on("mousedown","a",function(e){e.stopPropagation()});var dragging=0;target.on("mousedown",".item",function(e){var _=$(this),origX=e.pageX,origY=e.pageY,ready=!1,root=_.closest(".item-wrap");$(document).on("mousemove.dragCheck",function(e){if(Math.abs(e.pageX-origX)>5||Math.abs(e.pageY-origY)>5){dragging=1,$(document).off("mousemove.dragCheck");var modal=_.closest(".modal-dialog"),modalPos=modal.offset(),pos=_.offset(),top=pos.top-modalPos.top,left=pos.left-modalPos.left,h=_.outerHeight(),w=_.outerWidth(),ghost=_.clone().addClass("ghost");ghost.css({top:top,left:left,height:h,width:w}),ghost.appendTo(modal),Draggable.create(ghost,{type:"x,y",edgeResistance:.65,bounds:modal,onDrag:function(){this.hitTest(root,"50%")?(ready=!1,_.removeClass("ready-to-remove"),ghost.removeClass("ready-to-remove")):(ready=!0,_.addClass("ready-to-remove"),ghost.addClass("ready-to-remove"))},onDragEnd:function(){ready&&removeItem(_),ghost.remove()}}),Draggable.get(ghost).startDrag(e)}return!1}).on("mouseup.dragCheck",function(){dragging||removeItem(_),dragging=0,$(document).off("mouseup.dragCheck mousemove.dragCheck")})}),source.on("mousedown",".item",function(e){var _=$(this),origX=e.pageX,origY=e.pageY,ready=!1;$(document).on("mousemove.dragCheck",function(e){if(Math.abs(e.pageX-origX)>5||Math.abs(e.pageY-origY)>5){dragging=1,$(document).off("mousemove.dragCheck");var modal=_.closest(".modal-dialog"),modalPos=modal.offset(),pos=_.offset(),top=pos.top-modalPos.top,left=pos.left-modalPos.left,h=_.outerHeight(),w=_.outerWidth(),ghost=_.clone().addClass("ghost to-add");ghost.css({top:top,left:left,height:h,width:w}),ghost.appendTo(modal),Draggable.create(ghost,{type:"x,y",edgeResistance:.65,bounds:modal,onDrag:function(){this.hitTest(target,"50%")?(ready=!0,ghost.addClass("ready-to-add"),target.sly("toEnd",!0)):(ready=!1,ghost.removeClass("ready-to-add"))},onDragEnd:function(){ready&&addItem(_),ghost.remove()}}),Draggable.get(ghost).startDrag(e)}return!1}).on("mouseup.dragCheck",function(){dragging||addItem(_),dragging=0,$(document).off("mouseup.dragCheck mousemove.dragCheck")})})}function addItem(item){var empties=target.find(".item-wrap.empty");target.trigger("item.add",item),empties.length>0?empties.eq(0).append(item.clone(!0)).removeClass("empty"):(target.sly("add",'<div class="sign">+</div>'),target.sly("add",$('<div class="item-wrap"></div>').append(item.clone(!0)).get(0)))}function removeItem(item){var wraps=target.find(".item-wrap");if(target.trigger("item.remove",item),wraps.length>3){var parent=item.closest(".item-wrap");target.sly("remove",parent.prev(".sign")),target.sly("remove",parent)}else item.closest(".item-wrap").addClass("empty"),item.remove()}};