function UmScrollSpyMenu(links,opt){var t=this,body=$("body"),container=opt&&opt.container||$(window),accordeon=opt&&opt.accordeon||null;this.offset="fixed-top"===b2.s.topLinePosition?body.find(".top-line").outerHeight():0;var containerTop=container.offset()?container.offset().top:0,curTop=container.scrollTop(),curMin,curMax,absMin=0,absMax=body.height();function setTargetDims(target){var el=$(target.el);target.min=el.offset().top-t.offset-containerTop-10,target.max=target.min+el.outerHeight()}this.activeIndex,this.activate=function(index){index!==t.activeIndex&&(links.filter(".active").removeClass("active"),t.activeIndex=index,links.eq(t.activeIndex).addClass("active")),curMin=targets[t.activeIndex].min,curMax=targets[t.activeIndex].max},this.checkTarget=function(target,index){void 0!==target&&curTop>=target.min&&curTop<target.max&&t.activate(index)};var targets=[];function updateDims(){containerTop=container.offset()?container.offset().top:0,curTop=container.scrollTop(),$.each(targets,function(i){setTargetDims(targets[i]),t.checkTarget(targets[i],i)})}links.removeClass("active"),links.each(function(i){var targetElement,target={el:$($(this).attr("href"))};setTargetDims(target),targets.push(target),t.checkTarget(target,i)}),!curMin&&curTop<targets[0].min?(t.activeIndex=-1,curMin=0,curMax=targets[0].min):!curMax&&curTop>targets[targets.length-1].max&&(t.activeIndex=targets.length,curMin=targets[targets.length-1].max,curMax=absMax),this.next=function(){if(t.activeIndex===targets.length-1)return curMin=targets[targets.length-1].max,curMax=absMax,void t.activeIndex++;t.checkTarget(targets[t.activeIndex+1],t.activeIndex+1)},this.prev=function(){if(0===t.activeIndex)return curMin=0,curMax=targets[0].min,void t.activeIndex--;t.checkTarget(targets[t.activeIndex-1],t.activeIndex-1)},container.on("scroll.umScrollSpyMenu",function(){(curTop=container.scrollTop())<curMin?t.prev():curTop>=curMax&&t.next()}),links.on("click.umScrollSpyMenu",function(e){var _=$(this);return accordeon&&accordeon.open(_.index()),$(_.attr("href")).velocity("scroll",{duration:300,offset:-t.offset,complete:function(){t.activate(_.index())}}),!1});var updateTick=setInterval(updateDims,2e3);body.on("offsetChange.umScrollSpyMenu",function(){t.offset="fixed-top"===b2.s.topLinePosition?body.find(".top-line").outerHeight():0,updateDims()}),this.destroy=function(){clearInterval(updateTick),container.off("scroll.umScrollSpyMenu"),links.off("click.umScrollSpyMenu"),body.off("offsetChange.umScrollSpyMenu")}}