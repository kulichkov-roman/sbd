!function($){$.fn.flexGreedBannerSort=function(action,item,banner,banner_pos){var that=this,$target=$(this),orderingGreed;if($target.length&&void 0!==typeof item&&""!==item){var $items,$banners,w_target,w_line,firstInline,column,column_count,column_before,column_last,order=[];return this.create=function(){function compareOrder(obj1,obj2){var order1,order2;return(order1=""==$(obj1).css("order")?0:parseInt($(obj1).css("order")))>(order2=""==$(obj2).css("order")?0:parseInt($(obj2).css("order")))?1:order1<order2?-1:0}function eachItems(fn_items,action){if("ordering"===action||"not_ordering"===action)var tmp_banner=0,column_before_tmp=column_before;for(var i=0;i<fn_items.length-1;i++)"ordering"!==action&&"not_ordering"!==action||column<=column_before_tmp&&("ordering"===action?fn_items.eq(i).css({order:(parseInt(fn_items.eq(i).css("order"))-2*($banners.length-tmp_banner)).toString()}).addClass("js_sorting"):fn_items.eq(i).css({order:"-"+2*($banners.length-tmp_banner)}),order[tmp_banner]=parseInt(fn_items.eq(i).css("order"))),!0===firstInline?(w_line=fn_items.eq(i).get(0).offsetWidth-1,firstInline=!1):w_line+=fn_items.eq(i).get(0).offsetWidth-1,"ordering"!==action&&"not_ordering"!==action||column<=column_before_tmp&&column===column_before_tmp&&w_line+fn_items.eq(i+1).get(0).offsetWidth-1>w_target&&((tmp_banner+=1)!==$banners.length-1?column_before_tmp+=column_before:column_count%($banners.length+1)==0?column_before_tmp+=column_before:column_before_tmp+=column_last),w_line+fn_items.eq(i+1).get(0).offsetWidth-1>w_target&&(column+=1,firstInline=!0)}if($items=$target.find(item),($banners=$target.find(banner)).length){if(orderingGreed=!1,$items.each(function(){"0"!==$(this).css("order")&&($(this).addClass("js_sorting"),!1===orderingGreed&&(orderingGreed=!0))}),w_target=$target.get(0).offsetWidth-1,!0===orderingGreed){var $items_order=$target.find(item+".js_sorting"),$items_normal=$target.find(item+":not(.js_sorting)");$items_order.sort(compareOrder),$items_normal.each(function(){$items_order.push($(this).get(0))})}if(firstInline=!0,column=1,eachItems(!0===orderingGreed?$items_order:$items),(column_count=column)>$banners.length+1){var tmp_column;if(column_count%($banners.length+1)==0)column_before=column_count/($banners.length+1);else column_before=column_count/($banners.length+1)-Math.floor(column_count/($banners.length+1))<.5?Math.floor(column_count/($banners.length+1)):Math.floor(column_count/($banners.length+1))+1,(tmp_column=column_count-column_before*($banners.length-1))%2==1&&(void 0!==typeof banner_pos?"middle-to-bottom"===banner_pos?column_last=(tmp_column+1)/2:"middle-to-top"===banner_pos&&(column_last=(tmp_column-1)/2):column_last=(tmp_column-1)/2);firstInline=!0,column=1,!0!==orderingGreed?eachItems($items,"not_ordering"):eachItems($items_order,"ordering");for(var i=0;i<$banners.length;i++)$banners.eq(i).css({order:(order[i]+1).toString()})}else for(var i=0;i<$banners.length;i++)$banners.eq(i).css({order:"1"})}},this.update=function(){this.destroy(),this.create()},this.destroy=function(){$target.find(banner).css({order:""})},$(window).on("resize",resizeHandle),action&&"create"!==action||this.create(),"update"===action&&this.update(),"destroy"===action&&this.destroy(),this}function resizeHandle(){that.update()}}}(jQuery);