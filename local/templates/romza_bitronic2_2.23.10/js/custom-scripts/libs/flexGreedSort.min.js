!function($){$.fn.flexGreedSort=function(action,item,big,last,banner,banner_pos){var that=this,$target=$(this),$items,$items_last,$banners,w_target,w_normal,w_line,firstInline,line_tmp,line_sort,voids;if($target.length&&(void 0!==item&&""!==item&&void 0!==last&&""!==last))return item="."+item,big="."+big,banner="."+banner,$items=$target.find(item),void 0!==banner&&""!==banner&&($banners=$target.find(banner)),this.create=function(){$items_last=$target.find(item+"."+last),w_target=$target.get(0).offsetWidth-1,firstInline=!0,line_tmp=1,voids=0,void 0!==big&&""!==big&&(w_normal=$target.find(item+big).length?$target.find(item+":not("+big+")").eq(0).get(0).offsetWidth-1:$target.find(item).eq(0).get(0).offsetWidth-1);for(var i=0;i<$items.length-1;i++)!0===firstInline?(w_line=$items.eq(i).get(0).offsetWidth-1,firstInline=!1):w_line+=$items.eq(i).get(0).offsetWidth-1,$items.eq(i).hasClass(last)?w_line+w_normal<=w_target&&(voids+=1):w_line+$items.eq(i+1).get(0).offsetWidth-1>w_target&&(line_tmp+=1,firstInline=!0,w_line+w_normal<=w_target&&(voids+=1));line_sort=1,firstInline=!0;for(var i=0;i<$items.length;i++)if(!$items.eq(i).hasClass("ordered")&&(!0===firstInline?(w_line=$items.eq(i).get(0).offsetWidth-1,firstInline=!1):w_line+=$items.eq(i).get(0).offsetWidth-1,$items.eq(i).css("order","-"+2*line_tmp).addClass("ordered").attr("data-sort-order",2*line_tmp).attr("data-sort-line",line_sort),i!==$items.length-1)){var $not_ordered=$target.find(item+":not(.ordered)").eq(0);if(0!==$not_ordered.length&&w_line+$not_ordered.get(0).offsetWidth-1>w_target){var $items_normal;if(voids>0&&w_line+w_normal<=w_target)$target.find(item+":not(.ordered):not("+big+")").eq(0).css("order","-"+2*line_tmp).addClass("ordered").attr("data-sort-order",2*line_tmp).attr("data-sort-line",line_sort);line_tmp-=1,line_sort+=1,firstInline=!0}}if(void 0!==banner&&""!==banner){$banners=$target.find(banner);var page_from=0,page_to;$items_last.each(function(i,el){var tmp=((page_to=parseInt($(el).attr("data-sort-line")))-page_from)/2,order;tmp%2!=0&&("middle-to-bottom"===banner_pos?tmp=Math.floor(tmp)+1:"middle-to-top"===banner_pos&&(tmp=Math.floor(tmp))),tmp+=page_from,order=parseInt($target.find(item+'[data-sort-line="'+tmp+'"]').eq(0).attr("data-sort-order")),$banners.eq(i).css("order","-"+(order-1)),page_from=page_to})}},this.update=function(){this.destroy(),this.create()},this.destroy=function(){$items.each(function(){$(this).css("order","").removeClass("ordered").removeAttr("data-sort-order").removeAttr("data-sort-line")}),void 0!==banner&&""!==banner&&$banners.each(function(){$(this).css("order","")})},$(window).on("resize",resizeHandle),action&&"create"!==action||this.create(),"update"===action&&this.update(),"destroy"===action&&this.destroy(),this;function resizeHandle(){that.update()}}}(jQuery);