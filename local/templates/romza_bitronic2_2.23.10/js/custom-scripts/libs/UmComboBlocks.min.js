function UmComboBlocks(block,opt){var t=this;this.mode=opt&&opt.mode||null,this.mode||(this.mode="tabs"),this.tempMode=this.mode,this.hasSpy=opt&&opt.hasSpy||!1,this.bp=opt&&opt.bp||0,this.onOpen=opt&&opt.onOpen||function(){},this.defExpand=opt&&opt.defaultExpanded||0,this.linksContainer=block.children(".combo-links");var scrollfixWrap=this.linksContainer.children(".links-wrap"),bpReached,resizeTimer;function checkBp(){return(bpReached=Modernizr.mq("(max-width: "+t.bp+"px)"))&&"full"!==t.mode?(t.tempMode=t.mode,t.mode="full",!0):t.mode!==t.tempMode&&(t.mode=t.tempMode,!0)}function reset(){t.tabs&&("all"!==t.defExpand&&(t.defExpand=t.tabs.getIndex()),t.tabs.destroy(),t.tabs=null,block.removeClass("tabs")),t.full&&(t.full.destroy(),t.full=null,block.removeClass("full")),t.hasSpy&&t.scrollspy&&(t.scrollspy.destroy(),t.scrollspy=null,t.scrollfix&&t.scrollfix.destroy(),t.scrollfix=null)}function afterResize(){bpReached!==Modernizr.mq("(max-width: "+t.bp+"px)")&&checkBp()&&t.switchMode(t.mode),t.full?t.full.updateContent():t.tabs.updateContent()}this.links=block.find(".combo-link"),this.targets=block.find(".combo-target"),this.tabs,this.full,this.scrollspy,this.scrollfix,this.initFull=function(){if(reset(),t.full=new UmAccordeon(t.targets,{active:t.defExpand,onChange:function(target){t.onOpen(target),t.hasSpy&&t.scrollfix&&(t.scrollfix.getDims(),t.scrollfix.update(!0))}}),block.addClass("full").removeClass("tabs"),t.hasSpy){function initFix(){"function"==typeof UmScrollFix?t.scrollfix=new UmScrollFix(scrollfixWrap,t.linksContainer):setTimeout(initFix,1e3)}t.scrollspy=new UmScrollSpyMenu(t.links,{accordeon:t.full}),initFix()}},this.initTabs=function(){reset(),t.tabs=new UmTabs(t.links,{onChange:t.onOpen}),block.addClass("tabs")},this.switchMode=function(mode,check){check&&mode===t.mode||("tabs"===mode?t.initTabs():t.initFull(),t.mode=mode)},checkBp(),this.switchMode(t.mode),$(window).on("resize.combo",function(){clearTimeout(resizeTimer),resizeTimer=setTimeout(afterResize,300)}),this.destroy=function(){reset(),$(window).off("resize.combo")}}