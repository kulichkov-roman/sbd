!function(){"use strict";var defaultConf={ellipsis:"â€¦",debounce:0,responsive:!0,className:".clamp",lines:2,portrait:null,break_word:!0},_idCounter=0,RAF_SUPPORTED=!!window.requestAnimationFrame,newId=function(){return _idCounter+=1},setIdAttribute=function(element,id){element.setAttribute("data-ellipsis-id",id)},getIdAttribute=function(element){return element.getAttribute("data-ellipsis-id")},storeCache=function(cache,element){var id=newId();setIdAttribute(element,id),cache[id]=cache[id]||{},cache[id].element=element,cache[id].innerHTML=element.innerHTML},retrieveCache=function(cache,element){return cache?cache[getIdAttribute(element)]:null},getCachedElements=function(cache){return Object.keys(cache).map(function(value,index){return cache[value].element})},merge=function(obj1,obj2){var obj3={};for(var attrn in obj1)obj3[attrn]=obj1[attrn];for(var attrnm in obj2)obj3[attrnm]=obj2[attrnm];return obj3};function Ellipsis(opts){var conf=merge(defaultConf,opts||{});this.create(conf),this.add()}Ellipsis.prototype={conf:{},prop:{},lines:{},temp:null,listener:null,create:function(opts){if(this.conf=opts,this.lines={get current(){return opts.portrait&&window.innerHeight>window.innerWidth?opts.portrait:opts.lines}},this.conf.responsive){this.temp={};var debounceTime=this.conf.debounce,listener;if(RAF_SUPPORTED&&!debounceTime){this._isScheduled=!1;var self=this;listener=function(event){self._isScheduled||(self._isScheduled=!0,window.requestAnimationFrame(function(){self._isScheduled=!1,self.add(getCachedElements(self.temp))}))}}else{var debounce;debounceTime=debounceTime||16,listener=function(event){clearTimeout(debounce),debounce=setTimeout(function(){this.add(getCachedElements(this.temp))}.bind(this),debounceTime)}}this.listener=listener.bind(this),window.addEventListener("resize",this.listener,!1),window.removeEventListener("beforeunload",this.listener,!1)}},destroy:function(){this.listener&&window.removeEventListener("resize",this.listener,!1)},createProp:function(element){this.prop={get height(){var viewportOffset=element.getBoundingClientRect();return parseInt(viewportOffset.bottom-viewportOffset.top,10)},get lineheight(){var lineh=getComputedStyle(element).getPropertyValue("line-height");return String("normal|initial|inherit").indexOf(lineh)>-1&&(lineh=parseInt(getComputedStyle(element).getPropertyValue("font-size"),10)+2),parseInt(lineh,10)}}},add:function(elements){if(!elements&&this.conf.className&&(elements=document.querySelectorAll(this.conf.className)),elements)if(elements.length)for(var i=0;i<elements.length;i++)this.addElement(elements[i]);else void 0===elements.length&&this.addElement(elements)},addElement:function(element){if(this.conf.responsive){var cached=retrieveCache(this.temp,element);cached?element.innerHTML!==cached.innerHTML&&(element.innerHTML=cached.innerHTML):storeCache(this.temp,element)}this.createProp(element),this.isNotCorrect()&&(element.childNodes.length&&element.childNodes.length>1?this.handleChildren(element):element.childNodes.length&&1===element.childNodes.length&&3===element.childNodes[0].nodeType&&this.simpleText(element))},breakWord:function(str,str2,fix){var words=str.split(" ");if(words.pop(),fix&&words.pop(),!str2)return words[words.length-1]&&(words[words.length-1]=words[words.length-1].replace(/(,$)/g,"").replace(/(\.$)/g,"")),words.push(this.conf.ellipsis),words.join(" ");if(words[words.length-1])return words[words.length-1]=words[words.length-1].replace(/(,$)/g,"").replace(/(\.$)/g,""),words.push(this.conf.ellipsis),[words.join(" "),str2];if(!words[words.length-1]&&str2){var st=" "+str2.trim().replace(/(,$)/g,"").replace(/(\.$)/g,"")+" ";return words.push(this.conf.ellipsis),[words.join(" "),st]}console.log("broken")},simpleText:function(element){for(var childText=element.childNodes[0].nodeValue;this.prop.height>this.prop.lineheight*this.lines.current;)element.childNodes[0].nodeValue=childText.slice(0,-1),childText=element.childNodes[0].nodeValue;this.conf.break_word?(element.childNodes[0].nodeValue=childText.slice(0,-this.conf.ellipsis.length)+this.conf.ellipsis,this.isNotCorrect()&&(element.childNodes[0].nodeValue=" "+element.childNodes[0].nodeValue.slice(0,-(this.conf.ellipsis.length+1)).trim().slice(0,-this.conf.ellipsis.length)+this.conf.ellipsis)):(element.childNodes[0].nodeValue=this.breakWord(element.childNodes[0].nodeValue),this.isNotCorrect()&&(element.childNodes[0].nodeValue=this.breakWord(element.childNodes[0].nodeValue,null,!0)))},isNotCorrect:function(){return this.prop.height>this.prop.lineheight*this.lines.current},processBreak:function(dOne,dTwo,fix){var r=this.breakWord(dOne.innerText||dOne.nodeValue,dTwo.innerText||dTwo.nodeValue,fix);dOne.innerText?dOne.innerText=r[0]:dOne.nodeValue=r[0],dTwo.innerText?dTwo.innerText=r[1]:dTwo.nodeValue=r[1]},handleChildren:function(e){for(var domChildren=e.childNodes,childText,i=domChildren.length-1;i>=0;i--){var displayOrigin;if(8!==domChildren[i].nodeType){if(3===domChildren[i].nodeType?(displayOrigin=domChildren[i].nodeValue,domChildren[i].nodeValue=""):(displayOrigin=getComputedStyle(domChildren[i]).getPropertyValue("display"),domChildren[i].style.display="none"),this.prop.height<=this.prop.lineheight*this.lines.current){if(3===domChildren[i].nodeType){for(domChildren[i].nodeValue=displayOrigin,childText=domChildren[i].nodeValue;this.prop.height>this.prop.lineheight*this.lines.current;)domChildren[i].nodeValue=childText.slice(0,-1),childText=domChildren[i].nodeValue;if(this.conf.break_word){if(domChildren[i].nodeValue=childText.slice(0,-this.conf.ellipsis.length)+this.conf.ellipsis,this.isNotCorrect()){if(domChildren[i].nodeValue=" "+domChildren[i].nodeValue.slice(0,-this.conf.ellipsis.length).trim().slice(0,-this.conf.ellipsis.length),!(domChildren[i].nodeValue.length>1))continue;domChildren[i].nodeValue=domChildren[i].nodeValue.slice(0,-this.conf.ellipsis.length)+this.conf.ellipsis}}else{if(!domChildren[i].innerText&&!domChildren[i].nodeValue)continue;if(this.processBreak(domChildren[i],domChildren[i-1]),this.isNotCorrect()&&(this.processBreak(domChildren[i],domChildren[i-1],!0),this.isNotCorrect())){e.removeChild(domChildren[i]);continue}}}else{for(domChildren[i].style.display=displayOrigin,childText=domChildren[i].innerText;this.prop.height>this.prop.lineheight*this.lines.current;)domChildren[i].innerText=childText.slice(0,-1),childText=domChildren[i].innerText;if(this.conf.break_word){if(domChildren[i].innerText=childText.slice(0,-this.conf.ellipsis.length)+this.conf.ellipsis,this.isNotCorrect()){if(domChildren[i].innerText=" "+domChildren[i].innerText.slice(0,-this.conf.ellipsis.length).trim().slice(0,-this.conf.ellipsis.length),!(domChildren[i].innerText.length>1))continue;domChildren[i].innerText=domChildren[i].innerText.slice(0,-this.conf.ellipsis.length)+this.conf.ellipsis}}else{if(!domChildren[i].innerText&&!domChildren[i].nodeValue)continue;if(this.processBreak(domChildren[i],domChildren[i-1]),this.isNotCorrect()&&(this.processBreak(domChildren[i],domChildren[i-1],!0),this.isNotCorrect())){e.removeChild(domChildren[i]);continue}}}break}e.removeChild(domChildren[i])}}}};var EllipsisClass=function(opts){return new Ellipsis(opts)};"function"==typeof define&&define.amd&&define("ellipsis",[],function(){return EllipsisClass}),self.Ellipsis=EllipsisClass}();