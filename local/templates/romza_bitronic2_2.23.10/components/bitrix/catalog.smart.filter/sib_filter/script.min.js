function JCSmartFilter(ajaxURL,form_id,manual,hide_props){this.ajaxURL=ajaxURL,this.form=BX(form_id),this.timer=null,this.isFlying=!1,this.manual=manual,this.hideProps=hide_props,this.$form=$(this.form);var values=[];this.gatherInputsValues(values,BX.findChildren(this.form,{tag:"input"},!0)),void 0!==(values=this.values2post(values)).rz_all_elements&&(values.set_filter="y"),void 0!==values.set_filter&&void 0===values.del_filter&&(RZB2.ajax.CatalogSection.filterParams=values),this.ajaxURL.indexOf("/apply/")>-1&&-1==this.ajaxURL.indexOf("/clear/")&&($(".rbs-filter-shows").show(),$(".main-block .category").addClass("rbs-padding-filter")),this.$form.on("click","#del_filter",function(e){e.preventDefault();var $this=$(this);smartFilter.form=BX.findParent(e.target,{tag:"form"}),$(smartFilter.form).find(".show .show-results").addClass("disabled"),$(smartFilter.form).find(".jq-checkbox.js-formstyler").removeClass("checked"),$("#modef, #flying-results-wrap",".rbs-filter-shows").hide(),$(".main-block .category").removeClass("rbs-padding-filter"),$(smartFilter.form).find("[id^=slider_]").each(function(){var minInput=$(this).siblings(".range").find("input.range-input-lower");maxInput=$(this).siblings(".range").find("input.range-input-upper"),min=minInput.data("range-min"),max=maxInput.data("range-max"),minInput.attr({placeholder:parseInt(min)}),maxInput.attr({placeholder:parseInt(max)}),setRangeSliderLimits($(this),{left:min,right:max}),$(this).slider("values",[min,max])}),$(smartFilter.form).find("input[type=text]:enabled").val(""),$(smartFilter.form).find("input[type=checkbox],input[type=radio]").prop("checked",!1).prop("disabled",!1).parent().removeClass("disabled"),$(smartFilter.form).find("select").each(function(){var optionCount;$(this).find("option").length<=1&&($(this).find("option").prop("disabled",!0),b2.init.selects($(this).parent()))}),RZB2.ajax.CatalogSection.filterParams={},$this.addClass("disabled"),YSFilterRemoveDisable=!1;var sefDel=$this.data("sef-del");void 0!==sefDel&&sefDel.length>0&&(RZB2.ajax.CatalogSection.SefSetUrl=sefDel,RZB2.ajax.params.REQUEST_URI=sefDel),smartFilter.reload($(smartFilter.form).find("input:first")[0]),RZB2.ajax.CatalogSection.Start()}),this.$form.on("click",".btn-toggle-full-filter",function(e){var _=$(this);_.toggleClass("toggled");var filterFull=_.closest("#form_filter").find(".filter-full");return filterFull.hasClass("filter-opened")?(filterFull.removeClass("filter-opened"),filterFull.velocity("slideUp")):filterFull.velocity("slideDown",{complete:function(){filterFull.addClass("filter-opened"),filterShort.addClass("filter-opened")}}),!1}).on("submit",function(e){return!1}),$(document).on("click","#flying-results-wrap .btn-show-results, #"+form_id+" .show-results,.rbs-close-filter-btn",function(e){e.preventDefault(),RZB2.ajax.scrollPage($(".sort-n-view"),!0),$(".filters-toggle.js-filters").trigger("click")})}var YSFilterRemoveDisable=!1;function createSlider(params){var minPriceLimit=Number(params.VALUES.MIN),maxPriceLimit=Number(params.VALUES.MAX),currentMin=Number(params.HTML_VALUES.MIN.length?params.HTML_VALUES.MIN:params.VALUES.MIN),currentMax=Number(params.HTML_VALUES.MAX.length?params.HTML_VALUES.MAX:params.VALUES.MAX),minFilterLimit=Number(params.FILTERED_VALUES.MIN.length?params.FILTERED_VALUES.MIN:currentMin),maxFilterLimit=Number(params.FILTERED_VALUES.MAX.length?params.FILTERED_VALUES.MAX:currentMax),selectorSlider="#"+params.SLIDER_ID,selectorMin="#"+params.INPUT_ID.MIN,selectorMax="#"+params.INPUT_ID.MAX;$(selectorSlider).length&&($(selectorSlider).slider({range:!0,min:Math.floor(minPriceLimit),max:Math.ceil(maxPriceLimit),values:[minPriceLimit,maxPriceLimit],slide:function(event,ui){$(selectorMin).val(ui.values[0]),$(selectorMax).val(ui.values[1])},change:function(){smartFilter.keyup(BX(params.INPUT_ID.MIN))}}),$(selectorMin).val($(selectorSlider).slider("values",0)),$(selectorMax).val($(selectorSlider).slider("values",1)),$(selectorMin).change(function(){$(selectorSlider).slider("values",0,$(this).val())}),$(selectorMax).change(function(){$(selectorSlider).slider("values",1,$(this).val())}),$(selectorSlider).data("range",{min:minPriceLimit,max:maxPriceLimit}),setRangeSliderLimits($(selectorSlider),{left:minFilterLimit,right:maxFilterLimit}))}function setRangeSliderLimits($slider,limits){var min=$slider.data("range").min,max=$slider.data("range").max,left=parseFloat(limits.left)||min,right=parseFloat(limits.right)||max;left>right&&(right=left),left<min&&(left=min),right>max&&(right=max),left>=max?(left=max,right=max):right<=min&&(right=min,left=min);var leftPercent=(left-min)/(max-min)*100,rightPercent=(max-right)/(max-min)*100,$limiter=$slider.find(".noUi-limiter.base");0===leftPercent&&0===rightPercent?$limiter.addClass("hidden"):$limiter.removeClass("hidden"),$slider.data("noUi-limits",{left:left,right:right,leftPercent:leftPercent,rightPercent:rightPercent}),$limiter.css({left:leftPercent+"%",right:rightPercent+"%"})}JCSmartFilter.prototype.keyup=function(input){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate(function(){YSFilterRemoveDisable=!0,this.reload(input)},this),1e3)},JCSmartFilter.prototype.click=function(checkbox){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate(function(){YSFilterRemoveDisable=!0,this.reload(checkbox)},this),1e3)},JCSmartFilter.prototype.reload=function(input){var _this=$(input);_this.hasClass("rbs-clr-label")&&(_this.hasClass("rbs-clr-label-choosen")?_this.removeClass("rbs-clr-label-choosen"):_this.addClass("rbs-clr-label-choosen"));var $parent=$(input).parent();if($parent.is(":visible")&&(this.position=$parent.offset()),this.form=BX.findParent(input,{tag:"form"}),this.form){var values=[];values[0]={name:"ajax",value:"y"},this.gatherInputsValues(values,BX.findChildren(this.form,{tag:new RegExp("^(input|select)$","i")},!0)),this.updateFilterTagsList(values),this.values=this.values2post(values),BX.ajax.loadJSON(this.ajaxURL,this.values,BX.delegate(this.postHandler,this))}},JCSmartFilter.prototype.postHandler=function(result){if("SEO_FILTER"in result&&this.setSeoFilter(result),result&&result.ITEMS){for(var PID in result.ITEMS){var arItem=result.ITEMS[PID];if("N"==arItem.PROPERTY_TYPE||arItem.PRICE){var sliderId="#slider_"+(arItem.PRICE?"price_":"")+arItem.ID,slider=$(sliderId);if(slider.length<1)continue;var limits={};arItem.VALUES.MIN&&arItem.VALUES.MIN.FILTERED_VALUE&&(limits.left=arItem.VALUES.MIN.FILTERED_VALUE),arItem.VALUES.MAX&&arItem.VALUES.MAX.FILTERED_VALUE&&(limits.right=arItem.VALUES.MAX.FILTERED_VALUE),setRangeSliderLimits(slider,limits)}else if(arItem.VALUES)if("R"==arItem.DISPLAY_TYPE||"P"==arItem.DISPLAY_TYPE){var $select=!1;for(var i in arItem.VALUES){var ar,text=(ar=arItem.VALUES[i]).VALUE;ar.hasOwnProperty("ELEMENT_COUNT")&&(text+=" ("+ar.ELEMENT_COUNT+")"),($select=$('select[name="'+ar.CONTROL_NAME_ALT+'"]')).find('option[value="'+ar.HTML_VALUE_ALT+'"]').text(text).prop("disabled",!(!ar.DISABLED||ar.CHECKED))}$select&&(b2.init.selects($select.parent()),"function"==typeof b2.init.scrollbarsTargeted&&b2.init.scrollbarsTargeted($select.parent()))}else for(var i in arItem.VALUES){var ar=arItem.VALUES[i],control=BX(ar.CONTROL_ID);if(control&&$(control).is("select"));else if(control){var $brand;arItem.CODE==this.brandPropCode&&($brand=$('div[data-checkbox="'+ar.CONTROL_ID+'"]'));var className="disabled"+(this.hideProps?" hidden":"");$(control.parentNode).closest(".list-check__item").toggleClass(className,!!ar.DISABLED&&!ar.CHECKED),ar.DISABLED&&!control.checked?(control.setAttribute("disabled","disabled"),$brand&&$brand.addClass(className)):(control.removeAttribute("disabled"),$brand&&$brand.removeClass(className)),ar.hasOwnProperty("ELEMENT_COUNT")&&(label=$('[data-role="count_'+ar.CONTROL_ID+'"]'),label&&label.find(".count").html(ar.ELEMENT_COUNT)),$brand=void 0}}}if(!YSFilterRemoveDisable)return;var modef=BX("modef"),modef_num=BX("modef_num"),sideFilterWrap=$("#filter-at-side"),modef_flight=$("#flying-results-wrap"),modef_flight_num=BX("modef_flight_num"),_=this;modef&&modef_num&&(modef_num.innerHTML=result.ELEMENT_COUNT,"none"==modef.style.display&&(modef.style.display="block")),modef_flight.length&&modef_flight_num&&(modef_flight_num.innerHTML=result.ELEMENT_COUNT,modef_flight.css("top",this.position.top-sideFilterWrap.offset().top-10),this.isFlying||modef_flight.velocity("fadeIn"),clearTimeout(this.isFlying),this.isFlying=setTimeout(function(){modef_flight.velocity("fadeOut"),_.isFlying=!1},4e3)),result.FILTER_URL.indexOf("clear")>-1?($(".rbs-filter-shows").hide(),$(".main-block .category").removeClass("rbs-padding-filter")):($(".rbs-filter-shows").show(),$(".main-block .category").addClass("rbs-padding-filter"))}if(RZB2.ajax.CatalogSection.filterParams=this.values,RZB2.ajax.CatalogSection.ID>0&&"SEF_SET_FILTER_URL"in result&&result.SEF_SET_FILTER_URL.length>0&&(RZB2.ajax.CatalogSection.SefSetUrl=result.SEF_SET_FILTER_URL),delete RZB2.ajax.CatalogSection.filterParams.ajax,RZB2.ajax.CatalogSection.filterParams.set_filter="y",this.manual||RZB2.ajax.CatalogSection.Start(),YSFilterRemoveDisable&&($("#del_filter").removeClass("disabled"),this.$form.find(".show .show-results").removeClass("disabled")),this.hideProps){var $filterSections=$(".filter-section").has(".checkbox-styled, .radio-styled, select");($filterSections=($filterSections=$filterSections.not($filterSections.has('input:not([disabled]):not([value=""])').removeClass("hidden"))).not($filterSections.has('option:not([disabled]):not([value=""])').removeClass("hidden"))).addClass("hidden")}},JCSmartFilter.prototype.setSeoFilter=function(result){if("SEO_FILTER"in result&&void 0!==window.rzSeoFilter&&(window.rzSeoFilter(result.SEO_FILTER),"SEO_TEXT"in result.SEO_FILTER)){var $desc,$desc;if("RZ_SEO_TOP"in result.SEO_FILTER.SEO_TEXT)($desc=$(".rz_category_desc_top")).length&&$desc.find(".desc").html(result.SEO_FILTER.SEO_TEXT.RZ_SEO_TOP);if("RZ_SEO_BOT"in result.SEO_FILTER.SEO_TEXT)($desc=$(".rz_category_desc_bottom")).length&&$desc.find(".desc").html(result.SEO_FILTER.SEO_TEXT.RZ_SEO_BOT)}},JCSmartFilter.prototype.gatherInputsValues=function(values,elements){if(elements)for(var i=0;i<elements.length;i++){var el=elements[i];if(!el.disabled&&el.type)switch(el.type.toLowerCase()){case"number":case"text":case"textarea":case"password":case"hidden":case"select-one":if(el.value.length){values[values.length]={name:el.name,value:el.value,id:el.id,type:el.type};var $el=$(el);($el.hasClass("range-input-lower")||$el.hasClass("range-input-upper"))&&(values[values.length-1].value=el.value.replace(/\s+/g,""))}break;case"radio":case"checkbox":el.checked&&(values[values.length]={name:el.name,value:el.value,id:el.id,type:el.type});break;case"select-multiple":for(var j=0;j<el.options.length;j++)el.options[j].selected&&(values[values.length]={name:el.name,value:el.options[j].value,id:el.id,type:el.type})}}},JCSmartFilter.prototype.values2post=function(values){for(var post=[],current=post,i=0;i<values.length;){var p=values[i].name.indexOf("[");if(-1==p)current[values[i].name]=values[i].value,current=post,i++;else{var name=values[i].name.substring(0,p),rest=values[i].name.substring(p+1);current[name]||(current[name]=[]);var pp=rest.indexOf("]");-1==pp?(current=post,i++):0==pp?(current=current[name],values[i].name=""+current.length):(current=current[name],values[i].name=rest.substring(0,pp)+rest.substring(pp+1))}}return post},JCSmartFilter.prototype.updateFilterTagsList=function(values){var checkboxValues=[],checkboxIdList=[],obTagsList=$(".tags-list");for(var key in values)void 0!==values[key].id&&void 0!==values[key].type&&"checkbox"==values[key].type&&(checkboxValues[checkboxValues.length]=values[key],checkboxIdList[checkboxIdList.length]=values[key].id);for(var key in obTagsList.find(".tag button").each(function(){$.inArray($(this).attr("data-input-id"),checkboxIdList)<0&&$(this).parent(".tag").remove()}),obTagsList.find(".tag button").length||obTagsList.parent(".tags").addClass("hide"),checkboxValues)if(!$(".tags-list .tag button[data-input-id="+checkboxValues[key].id+"]").length){var html='<div class="tag"><span class="tag-text">'+$("#catalog-filter-form #"+checkboxValues[key].id).siblings("span").text()+'</span><button class="btn-closebtn" data-input-id="'+checkboxValues[key].id+'"><span class="btn-text"></span></button></div> ';obTagsList.append(html).parent(".tags").removeClass("hide")}};