function skuPropChangeHandler(e){e||(e=window.event);var select=$(this),basketItemId,property,property_values={},postData={},action_var,all_sku_props,i,sku_prop_value,m;select.length<1||select.val()!=select.find("[selected]").val()&&(select.find("[selected]").removeAttr("selected"),select.find('[value="'+select.val()+'"]').attr("selected","selected"),RZB2.ajax.loader.Start($("#basket_form_container")),basketItemId=select.closest("tr").attr("id"),property=select.data("property"),action_var=BX("action_var").value,property_values[property]=select.val(),(all_sku_props=$("#"+basketItemId).find(".sku select")).each((function(){$(this).attr("id")!=="prop_"+property+"_"+basketItemId&&(property_values[$(this).data("property")]=$(this).val())})),(postData={basketItemId:basketItemId,sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:property_values,action_var:action_var,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,count_discount_4_all_quantity:BX("count_discount_4_all_quantity").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value})[action_var]="select_item",BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:postData,dataType:"json",onsuccess:function(result){if("object"==typeof result&&"ERROR"==result.CODE){var message=result.MESSAGE||BX.message("basket_sku_not_available");return RZB2.ajax.showMessage(message,"fail"),RZB2.ajax.loader.Stop($("#basket_form_container")),void select.closest("tr").addClass("out-of-stock").removeClass("available-for-order")}recalcBasketAjax({BasketRefresh:"n"})}}))}function checkOut(){return BX("coupon")&&(BX("coupon").disabled=!0),BX("basket_form").submit(),!0}function enterCoupon(){var newCoupon=BX("coupon");newCoupon&&newCoupon.value&&recalcBasketAjax({coupon:newCoupon.value})}function updateQuantity(controlId,basketId,ratio,bUseFloatQuantity){var oldVal=BX(controlId).defaultValue,newVal=parseFloat(BX(controlId).value)||0,bIsCorrectQuantityForRatio=!1;if(0===ratio||1==ratio)bIsCorrectQuantityForRatio=!0;else{var newValInt,ratioInt,reminder=1e4*newVal%(1e4*ratio),newValRound=parseInt(newVal);0===reminder&&(bIsCorrectQuantityForRatio=!0)}var bIsQuantityFloat=!1;parseInt(newVal)!=parseFloat(newVal)&&(bIsQuantityFloat=!0),newVal=!1===bUseFloatQuantity&&!1===bIsQuantityFloat?parseInt(newVal):parseFloat(newVal).toFixed(2),bIsCorrectQuantityForRatio?(BX(controlId).defaultValue=newVal,BX("QUANTITY_INPUT_"+basketId).value=newVal,BX("QUANTITY_"+basketId).value=newVal,recalcBasketAjax({})):(newVal=getCorrectRatioQuantity(newVal,ratio,bUseFloatQuantity))!=oldVal?(BX("QUANTITY_INPUT_"+basketId).value=newVal,BX("QUANTITY_"+basketId).value=newVal,recalcBasketAjax({})):BX(controlId).value=oldVal}function setQuantity(basketId,ratio,sign,bUseFloatQuantity){var curVal=parseFloat(BX("QUANTITY_INPUT_"+basketId).value),newVal;(newVal="up"==sign?curVal+ratio:curVal-ratio)<0&&(newVal=0),bUseFloatQuantity&&(newVal=newVal.toFixed(2)),ratio>0&&newVal<=ratio?(newVal=ratio,$("#QUANTITY_DOWN_"+basketId).addClass("disabled")):$("#QUANTITY_DOWN_"+basketId).removeClass("disabled"),bUseFloatQuantity||newVal==newVal.toFixed(2)||(newVal=newVal.toFixed(2)),newVal=getCorrectRatioQuantity(newVal,ratio,bUseFloatQuantity),BX("QUANTITY_INPUT_"+basketId).value=newVal,BX("QUANTITY_INPUT_"+basketId).defaultValue=newVal}function getCorrectRatioQuantity(quantity,ratio,bUseFloatQuantity){var newValInt,ratioInt,reminder=1e4*quantity%(1e4*ratio),result=quantity,bIsQuantityFloat=!1,i;if(ratio=parseFloat(ratio),0===reminder)return result;if(0!==ratio&&1!=ratio)for(i=ratio,max=parseFloat(quantity)+parseFloat(ratio);i<=max;i=parseFloat(parseFloat(i)+parseFloat(ratio)).toFixed(2))result=i;else 1===ratio&&(result=0|quantity);return parseInt(result,10)!=parseFloat(result)&&(bIsQuantityFloat=!0),result=!1===bUseFloatQuantity&&!1===bIsQuantityFloat?parseInt(result,10):parseFloat(result).toFixed(2)}function recalcBasketAjax(params,simpleUpdate,actionType){var property_values={},action_var=BX("action_var").value,items=BX("basket_items"),delayedItems=BX("delayed_items"),postData,i;if(postData={sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:property_values,action_var:action_var,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,count_discount_4_all_quantity:BX("count_discount_4_all_quantity").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value,rz_ajax:"y",rz_ajax_no_header:"y",BasketRefresh:"y",self_url:basketJSParams.SELF_URL,tab:$("#basket_form .um_tab.active").data("tab")},!simpleUpdate){if(params&&"object"==typeof params)for(i in params)params.hasOwnProperty(i)&&(postData[i]=params[i]);if(items&&items.childNodes.length>0)for(i=1;items.childNodes.length>i;i++)void 0!==items.childNodes[i].id&&Number(items.childNodes[i].id)>0&&(postData["QUANTITY_"+items.childNodes[i].id]=BX("QUANTITY_"+items.childNodes[i].id).value);if(delayedItems&&delayedItems.rows.length>0)for(i=1;delayedItems.rows.length>i;i++)void 0!==delayedItems.childNodes[i].id&&Number(delayedItems.childNodes[i].id)>0&&(postData["DELAY_"+delayedItems.childNodes[i].id]="Y")}RZB2.ajax.loader.Start($("#basket_form_container")),BX.ajax({url:SITE_DIR+"ajax/sib/big_basket_sib.php",method:"POST",data:postData,dataType:"html",onsuccess:function(result){if(RZB2.ajax.loader.Stop($("#basket_form_container")),"deleteItem"!==actionType||$(result).find("#basket_items").length){var total=$(result).find(".total").contents(),mobileTotal=$(result).find(".is-mobile-only").contents(),items=$(result).find("#basket_items .cart-item");$("#basket_form").find(".total").html(total),$("#basket_form").find(".is-mobile-only").html(mobileTotal),items.each((function(){var priceBlock=$(this).find(".price.price_sale").contents(),itemID="#"+$(this).attr("id"),priceTotalMobile=$(this).find(".price__total.mobile").contents();$("#basket_items").find(itemID+" .price.price_sale").html(priceBlock),$("#basket_items").find(itemID+" .price__total.mobile").html(priceTotalMobile)})),"addItem"===actionType&&(newItem=items.last(),$("#basket_items").append(newItem))}else $("#basket_form").html(result),refreshMainSpecSlider(),$("main.main.main_cart-empty").removeClass("main_cart-full");$("#basket_form").find("img.lazy").lazyload()}})}var bigBasketTimerQuantity,bigBasketTimerTimeout,bigBasketUpdateTimeout;function initSliders(){$(".js-slider-7").on("init",(function(){$(".js-ellip-2 span").length&&$(".js-ellip-2 span").shave(72)})),$(".js-slider-7").each((function(){$(this).hasClass("slick-initialized")||(window.screen.width<=640&&$(this).find(".catalog-item").length<=1?$(this).find(".placeholder").lazyload({data_attribute:"lazy-jpg",data_attribute_webp:"lazy"}):$(this).slick({dots:!0,arrows:!0,infinite:!0,autoplay:!1,speed:300,slidesToShow:6,slidesToScroll:1,adaptiveHeight:!0,responsive:[{breakpoint:1420,settings:{slidesToShow:5}},{breakpoint:1355,settings:{slidesToShow:4}},{breakpoint:1145,settings:{slidesToShow:3}},{breakpoint:1023,settings:{slidesToShow:4}},{breakpoint:640,settings:{slidesToShow:1}}]}))}))}function refreshMainSpecSlider(){var mainBlock=$(".main-block_index");mainBlock.find(".js-slider-2").on("init",(function(){$(this).on("afterChange",(function(){mainBlock.find("img.lazy").lazyload()}))})),$(".js-slider-2").length&&$(".js-slider-2").slick({dots:!0,arrows:!0,infinite:!0,autoplay:!1,swipeToSlide:!0,slidesToShow:5,slidesToScroll:1,touchThreshold:200,speed:300,adaptiveHeight:!0,lazyLoad:"progressive",responsive:[{breakpoint:1400,settings:{slidesToShow:4}},{breakpoint:1150,settings:{slidesToShow:3}},{breakpoint:1023,settings:{slidesToShow:3}},{breakpoint:700,settings:{slidesToShow:2}},{breakpoint:480,settings:{slidesToShow:1}}]}),$(".js-rating").length&&$(".js-rating").barrating({showSelectedRating:!1,readonly:!0})}$(document).ready((function(){$("#basket_form").length&&$("main.main.main_cart-empty").addClass("main_cart-full"),$("#basket_form").on("mousedown","button.qty__btn",(function(e){e=e||window.event;var _=$(this);if(!_.hasClass("disabled")){var id=parseInt(_.closest(".cart-item").attr("id"),10),ratio=parseFloat(_.data("ratio")),sign=_.hasClass("decrease")?"down":"up",bUseFloatQuantity="Y"==$("#quantity_float").val();setQuantity(id,ratio,sign,bUseFloatQuantity),clearTimeout(bigBasketUpdateTimeout),bigBasketTimerTimeout=setTimeout((function(){bigBasketTimerQuantity=setInterval((function(){setQuantity(id,ratio,sign,bUseFloatQuantity)}),100)}),300),_.data("changed",!0)}})).on("mouseup mouseleave","button.qty__btn",(function(e){clearTimeout(bigBasketTimerTimeout),clearInterval(bigBasketTimerQuantity);var _=$(this);if(_.data("changed")){_.data("changed",!1);var basketId=parseInt(_.closest(".cart-item").attr("id"),10),ratio=parseFloat(_.data("ratio")),bUseFloatQuantity="Y"==$("#quantity_float").val();bigBasketUpdateTimeout=setTimeout((function(){updateQuantity("QUANTITY_INPUT_"+basketId,basketId,ratio,bUseFloatQuantity)}),300)}})).on("click","button.qty__btn",(function(e){return!1})).on("click",".cart-item__del",(function(e){e.preventDefault();var _=$(this),cartItem=_.closest(".cart-item");recalcBasketAjax({action:_.data("action"),id:_.data("id")},!1,"deleteItem"),cartItem.remove(),RZB2.ajax.BasketSmall.ElementsList={},setTimeout((function(){$("#basket_items .cart-filter-list__link.active").click()}),200)})).on("click",".location__close.button-close",(function(e){e.preventDefault();var _=$(this),item=_.closest(".catalog-item"),cartItem=_.closest(".cart-item"),deleteCartItemID=$('#basket_items .cart-item[data-product="'+_.data("product")+'"]')[0].id;recalcBasketAjax({action:_.data("action"),id:deleteCartItemID},!1,"deleteItem"),$("#basket_items .cart-item#"+deleteCartItemID).remove(),item.removeClass("active"),RZB2.ajax.BasketSmall.ElementsList={},setTimeout((function(){cartItem.siblings().find(".cart-filter-list__link.active").click()}),200)})).on("click","button[data-coupon]",(function(e){var value=$(this).attr("data-coupon");value&&value.length>0&&recalcBasketAjax({delete_coupon:value})})).on("mouseover",".total__input.inputed",(function(params){$(this).next("#btn_delete").addClass("active").removeClass("disable")})).on("mouseleave",".total__input.inputed",(function(params){$(this).next("#btn_delete").removeClass("active").addClass("disable")})).on("mouseover","#btn_delete",(function(params){$(this).addClass("active").removeClass("disable")})).on("mouseleave","#btn_delete",(function(params){$(this).removeClass("active").addClass("disable")})).on("click",".coupon-link",(function(e){$(this).remove(),e.preventDefault()})).on("mouseenter","button.apply-coupon.valid",(function(){$(this).find("i").removeClass("flaticon-check33").addClass("flaticon-x5")})).on("mouseleave","button.apply-coupon.valid",(function(){$(this).find("i").removeClass("flaticon-x5").addClass("flaticon-check33")})).on("change",".sku select",skuPropChangeHandler).on("click",".button.btn-action",(function(e){e.preventDefault();var item=$(this).closest(".catalog-item"),btn=item.find(".button"),id=item.data("id"),cartItem=$(this).closest(".cart-item");if("undefined"!=typeof VK){var retargetProduct={id:btn.data("product-id"),group_id:btn.data("group-id"),price:parseInt(btn.data("price")),price_old:parseInt(btn.data("price-old"))};(retargetProduct.price_old<=0||retargetProduct.price>=retargetProduct.price_old)&&delete retargetProduct.price_old,VK.Retargeting.ProductEvent(PRICE_LIST_ID,"add_to_cart",{products:[retargetProduct],currency_code:"RUR",total_price:retargetProduct.price})}RZB2.ajax.BigBasket.AddToBasket(id),item.addClass("active"),setTimeout((function(){cartItem.siblings().find(".cart-filter-list__link.active").click()}),200)})).on("click",".cart-filter-list__link",(function(e){if(e.preventDefault(),!$(this).hasClass("last_link")){$(this).parent().prevAll().find(".cart-filter-list__link").removeClass("active"),$(this).parent().nextAll().find(".cart-filter-list__link").removeClass("active"),$(this).addClass("active");var item=$(this).closest(".cart-item");itemID=item.data("product"),sectionID=$(this).data("section"),data={},data.rz_ajax="y",data.item=itemID,data.section=sectionID,$.ajax({type:"POST",url:SITE_DIR+"ajax/sib/cart_accessories.php",data:data,success:function(res){item.find(".cart-slider").html(res),initSliders(),RZB2.ajax.quickViewInit($("#basket_form"),".js-fancybox-accessory")}})}})).find(".scroll-slider-wrap").each((function(){return initHorizontalCarousels($("#basket_form")),!1})),$("#popup-accessories").on("click","button.buy",(function(e){var productID=$(this).data("product-id");$('#basket_items .catalog-item[data-id="'+productID+'"]').addClass("active")})),$("#basket_items").find(".cart-filter-list__link").first().addClass("active"),$(window).scroll((function(){if($(".cart").length){var headerHeight=$("header.header")[0].scrollHeight,cartHeight,commonHeight=$(".cart")[0].scrollHeight+headerHeight-500,fixedBlock=$(".is-mobile-only");$(this).scrollTop()>=commonHeight?fixedBlock.addClass("_hide"):fixedBlock.removeClass("_hide")}}))})),$(window).load((function(){RZB2.ajax.quickViewInit($("#basket_form"),".js-fancybox-accessory")}));