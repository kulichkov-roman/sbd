var edost_office_create_c=function(name){var self=this,protocol="https:"==document.location.protocol?"https://":"http://",geo,format,param_profile,onkeydown_backup="free",overflow_backup=!1,onclose="",map_loading=!1,api21=!1,browser_width=0,browser_height=0,small_ico=!1,update_number=0,param_start,onclose_set_office_start,loading='<div class="edost_map_loading"><img src="'+protocol+'edostimg.ru/img/site/loading.gif" border="0" width="64" height="64"></div>',tariff_info='<div class="edost_button2_info2">чтобы выбрать пункт выдачи, нажмите на подходящий тариф</div>',free_ico="Бесплатно!";this.map=!1,this.data=!1,this.timer=!1,this.timer_resize=!1,this.timer_inside=!1,this.data_string="",this.data_parsed=!1,this.loading_inside="",this.inside=!1,this.isMobile=BX.browser.IsMobile(),this.clone=function(o){var v={};for(var p in o)if(o[p]instanceof Array){v[p]=[];for(var i=0;i<o[p].length;i++)v[p][i]=o[p][i]}else v[p]=o[p];return v},this.window=function(param,onclose_set_office){"shop"!=param&&"office"!=param&&"terminal"!=param&&"all"!=param&&"profile"!=param.substr(0,7)&&"inside"!=param||(param_start=param,onclose_set_office_start=onclose_set_office),"profile"==param.substr(0,7)&&(param_profile=param.substr(8),param="profile"),"inside"==param?(self.inside=!0,param="all"):"show"!=param&&(self.inside=!1),1==onclose_set_office&&(onclose=param);var office_format=format;if("shop"!=param&&"office"!=param&&"terminal"!=param&&"all"!=param&&"profile"!=param||(format=param,param_profile&&(format+="_"+param_profile),param="show"),"esc"==param){if(self.map&&self.map.balloon.isOpen())return void self.balloon("close");param="close"}if(self.inside||("show"!=param?(document.onkeydown=onkeydown_backup,document.body.style.overflow=overflow_backup,onkeydown_backup="free"):"free"==onkeydown_backup&&(onkeydown_backup=document.onkeydown,overflow_backup=document.body.style.overflow,document.onkeydown=new Function("event","if (event.keyCode == 27) "+name+'.window("esc");'))),self.inside){var E=document.getElementById("edost_office_inside");if(!E)return;var E2=document.getElementById("edost_office_inside_head");E2||(E.innerHTML='<div id="edost_office_inside_head" class="edost_office_inside_head"></div><div id="edost_office_inside_map"></div>')}else{var E=document.getElementById("edost_office_window");if(!E){var E=document.querySelector("#bx-soa-delivery .rbs-edost-map"),E2=document.createElement("DIV");E2.className="edost_office_window",E2.id="edost_office_window",E2.style.display="none",E2.innerHTML='<div id="edost_office_window_head" class="edost_office_window_head"></div><div id="edost_office_window_map"></div>',E.appendChild(E2)}}var E=document.getElementById("edost_office_balloon");if(!E){var E=document.body,E2=document.createElement("DIV");E2.className="edost_office_balloon",E2.id="edost_office_balloon",E2.style.display="none",E2.innerHTML='<div id="edost_office_balloon_data"></div><div style="margin: 30px auto 0 auto;"><div class="edost_button_info" style="display: inline; margin: 0; padding: 10px 20px;" onclick="'+name+".balloon('close');\">закрыть</div></div>",E.appendChild(E2)}var E=document.getElementById("edost_office_info");if(!E){var E=document.body,E2=document.createElement("DIV");E2.className="edost_office_info",E2.id="edost_office_info",E2.style.display="none",E2.innerHTML='<div id="edost_office_info_data"></div><div style="margin: 5px auto 0 auto;"><div class="edost_button_info" style="display: inline; margin: 0 30px 0 0; background: #888; font-size: 12px;" onclick="edost_office.info(\'blank\');">страница для печати</div><div class="edost_button_info" style="display: inline; margin: 0; padding: 10px 20px;" onclick="edost_office.info(\'close\');">закрыть</div></div>',E.appendChild(E2)}var display="show"!=param?"none":"block",office_data=document.getElementById("edost_office_data");if(office_data){var E=document.getElementById(self.inside?"edost_office_inside":"edost_office_window");if(E){if(E.style.display=display,!self.inside){var E=document.getElementById("edost_office_window_fon");E&&(E.style.display=display)}if("close"==param&&""!=onclose){var s=onclose;onclose="",edost_SetOffice_c(s)}if("show"==param){if(self.fit("ico"),self.map&&("parsed"!=office_data.value||!self.data_parsed||office_format!=format)){"parsed"!=office_data.value?(self.data_string=office_data.value,office_data.value="parsed",edost_office.data_parsed=edost_office2.data_parsed=!1):self.data_parsed||(self.data_string="edost_office"==name?edost_office2.data_string:edost_office.data_string);var v=window.JSON&&window.JSON.parse?JSON.parse(self.data_string):eval("("+self.data_string+")");self.data=[],self.data_parsed=!0;for(var tariff=[],point=v.point,ico_path=v.ico_path+("/"!=v.ico_path.substr(-1)?"/":""),cod_tariff=!1,i=0;i<v.tariff.length;i++){var ar=v.tariff[i].split("|");if(null!=ar[13]){var p={profile:ar[0],company:ar[1],name:ar[2],tariff_id:ar[3],price:ar[4],price_formatted:ar[5],pricecash:ar[6],codplus:ar[7],codplus_formatted:ar[8],day:ar[9],insurance:ar[10],to_office:ar[11],company_id:ar[12],format:ar[13],cod_tariff:null!=ar[14]?ar[14]:""};p.format!=format&&"all"!=format&&format!="profile_"+p.profile||tariff.push(p)}}for(var i=0;i<point.length;i++){for(var p=[],i2=0;i2<point[i].data.length;i2++){var ar=point[i].data[i2].split("|");if(null!=ar[7]){var v={id:ar[0],name:ar[1],address:ar[2],schedule:ar[3].replace(/,/g,"<br>"),gps:ar[4].split(","),type:ar[5],metro:ar[6],codmax:ar[7],detailed:null!=ar[8]&&ar[8]};p.push(v)}}point[i].data=p}for(var office=[],i=0;i<tariff.length;i++){for(var v=tariff[i],u=-1,i2=0;i2<office.length;i2++)if(v.company_id==office[i2].company_id&&v.to_office==office[i2].to_office){u=i2;break}if(-1==u){var r={company:v.company,company_id:v.company_id,ico:v.tariff_id,to_office:v.to_office,format:v.format,point:[],button:"",button2:"",button2_info:"",button_cod:"",button_cod2:"",cod:!0,header2:"",header2_min:""};r.header='<span class="edost_name">'+v.company+"</span>",u=office.length,office[u]=r}""==v.codplus?office[u].cod=!1:(null==office[u].codplus_max||1*v.codplus>1*office[u].codplus_max[0])&&(office[u].codplus_max=[v.codplus,v.codplus_formatted]),(null==office[u].price_min||1*v.price<1*office[u].price_min[0])&&(office[u].price_min=[v.price,v.price_formatted]),(null==office[u].price_max||1*v.price>1*office[u].price_max[0])&&(office[u].price_max=[v.price,v.price_formatted]),""!==v.pricecash&&(null==office[u].pricecash_max||1*v.pricecash>1*office[u].pricecash_max)&&(office[u].pricecash_max=v.pricecash),""!=v.cod_tariff&&(cod_tariff=!0);var price=0==v.price_formatted?'<span class="edost_price_free">'+free_ico+"</span>":'<span class="edost_price">'+v.price_formatted+"</span>",s=[];""!=v.day&&s.push('<span class="edost_day">'+v.day+"</span>"),""!=v.name&&s.push('<span class="edost_tariff">'+v.name+"</span>"),1==v.insurance&&"Y"!=v.cod_tariff&&s.push('<span class="edost_insurance">со страховкой</span>');var s2="<span>"+price+"</span>"+(s.length>0?"<br>"+s.join(", "):""),button,c;if(s=price+(s.length>0?" ("+s.join(", ")+")":""),"Y"!=v.cod_tariff&&(office[u].header2+="<br>"+s,office[u].price_min[0]==v.price&&(office[u].header2_min="<br>"+price+'<br><span class="edost_day">'+v.day+"</span>")),""!=v.cod_tariff){var c='<br><div class="edost_payment_map"><span class="edost_payment_'+("N"==v.cod_tariff?"normal":"cod")+'">'+("N"==v.cod_tariff?"с предоплатой заказа":"с оплатой при получении")+"</span></div>";s+=c,s2+=c}"shop"==v.format?button="":(c="edost_SetOffice_c('"+v.profile+"', '%office%', '"+v.cod_tariff+"', '"+v.format+"')",button='<div class="edost_button" onclick="'+c+'"><table align="center" cellpadding="0" cellspacing="0" border="0"><tr><td class="edost_button_left">'+s+'</td><td class="edost_button_right">выбрать</td></tr></table></div>'),button2='<div class="edost_button2" onclick="'+name+".balloon('close'); "+c+'">'+s2+"</div>",office[u].button+=button,office[u].button2+=button2,"Y"!=v.cod_tariff&&(office[u].button_cod+=button,office[u].button_cod2+=button2),office[u].button2_info=tariff_info}for(var ar=[],i=0;i<office.length;i++){var v=self.clone(office[i]);if(ar.push(v),office[i].cod){for(var a=!0,i2=0;i2<office.length;i2++)if(i!=i2&&office[i].company_id==office[i2].company_id&&office[i].button_cod==office[i2].button_cod&&!office[i2].cod){a=!1;break}if(a){var v=self.clone(office[i]);v.cod=!1,v.button=office[i].button_cod,v.button2=office[i].button_cod2,ar.push(v)}}}office=ar;for(var n=0;n<=1;n++)for(var i=0;i<office.length;i++)if(0==n&&""!=office[i].to_office||1==n&&""==office[i].to_office)for(var u=0;u<point.length;u++)if(point[u].company_id==office[i].company_id)for(var u2=0;u2<point[u].data.length;u2++)if("none"!=point[u].data[u2]){if(0==n&&point[u].data[u2].type!=office[i].to_office)continue;var v=point[u].data[u2];v.cod=office[i].cod,v.cod&&""!==v.codmax&&1*office[i].pricecash_max>1*v.codmax&&(v.cod=!1);var a=!0;if(office[i].cod&&!v.cod)for(var i2=0;i2<office.length;i2++)if(i!=i2&&office[i].company_id==office[i2].company_id&&office[i].button_cod==office[i2].button_cod&&!office[i2].cod){office[i2].point.push(v),a=!1;break}a&&office[i].point.push(v),point[u].data[u2]="none"}if(!self.inside){for(var n=0,i=0;i<office.length;i++)office[i].cod&&office[i].point.length>0&&n++;if(0!=n&&n!=office.length)for(var i=0;i<office.length;i++)office[i].cod&&(office[i].header2+='<div class="edost_payment">+ возможна оплата при получении</div>',office[i].header2_min+='<div class="edost_payment">+ возможна<br> оплата при<br> получении</div>')}for(var n=office.length,s="",price_min=-1,count=0,i=0;i<n;i++)office[i].point.length>0&&count++;self.inside&&count>=6&&(small_ico=!0);for(var i=0;i<n;i++)if(office[i].point.length>0){office[i].button+='<div class="edost_button_bottom"></div>',(-1==price_min||1*office[i].price_min[0]<1*price_min)&&(price_min=office[i].price_min[0]);var v=office[i],head="";1==n&&(head=1==v.point.length?26==v.company_id?"Постамат / пункт выдачи":72==v.company_id?"Почтомат":"terminal"==v.format?"Терминал ТК":"shop"==v.format?"Магазин":"Пункт выдачи":26==v.company_id?"Постаматы и пункты выдачи":72==v.company_id?"Почтоматы":"terminal"==v.format?"Терминалы ТК":"shop"==v.format?"Адреса магазинов":"Пункты выдачи"),"s"!=v.company_id.substr(0,1)||"Самовывоз"!=v.company.substr(0,9)&&"shop"!=v.format||(1!=n&&n<=5&&(head=1==v.point.length?"shop"==v.format?"Магазин":"Пункт выдачи":"shop"==v.format?"Магазины":"Пункты выдачи"),office[i].header=""),""!=head&&(head='<span class="edost_name">'+head+" </span>"),s+='<td id="'+name+"_price_td_"+i+'" onclick="'+name+".set_map("+i+');">',s+='<img class="edost_ico edost_ico_'+(small_ico?"small":"normal")+'" src="'+ico_path+office[i].ico+'.gif" border="0">'+head,n<=5&&(s+=office[i].header),small_ico||(n>5?s+=office[i].header2_min:n>1&&(s+=office[i].header2)),s+="</td>",n>1&&(s+='<td width="8" class="edost_office_head_delimiter"></td><td width="8"></td>')}else office.splice(i,1),i--,n--;var E=document.getElementById("edost_office_"+(self.inside?"inside":"window")+"_head");self.inside?E.innerHTML="":E.innerHTML='<table class="edost_office_head" cellpadding="0" cellspacing="0" border="0"><tr>'+s+'<td width="120" class="edost_office_head_all"><div id="'+name+'_price_td_all" onclick="'+name+".set_map('all');\">показать все</div></td></tr></table>";for(var n=-1,i=0;i<office.length-1;i++)for(var i2=0;i2<office[i].point.length;i2++)if(null==office[i].point[i2].repeat){for(var repeat_individual=!1,u=i;u<office.length;u++)for(var start=u==i?i2+1:0,u2=start;u2<office[u].point.length;u2++)null==office[u].point[u2].repeat&&office[i].point[i2].address==office[u].point[u2].address&&(null==office[i].point[i2].repeat&&(n++,office[i].point[i2].repeat=n),office[u].point[u2].repeat=n,office[i].point[i2].schedule==office[u].point[u2].schedule&&(5!=office[i].point[i2].type&&6!=office[i].point[i2].type||office[i].point[i2].type==office[u].point[u2].type)||(repeat_individual=!0));if(repeat_individual){office[i].point[i2].repeat_individual=!0;for(var u=i;u<office.length;u++)for(var u2=0;u2<office[u].point.length;u2++)office[u].point[u2].repeat==n&&(office[u].point[u2].repeat_individual=!0)}}for(var n=0,i=0;i<office.length;i++)1*office[i].price_min[0]>1*price_min+50?office[i].bold=!1:(office[i].bold=!0,n++);if(n==office.length)for(var i=0;i<office.length;i++)office[i].bold=!1;self.data=office,self.map&&(api21?self.map.geoObjects.removeAll():self.map.geoObjects.each(function(v){self.map.geoObjects.remove(v)})),geo=new ymaps.Clusterer({preset:api21?"islands#invertedDarkBlueClusterIcons":"twirl#invertedBlueClusterIcons",groupByCoordinates:!1,clusterDisableClickZoom:!1,zoomMargin:100});for(var repeat=[],i=0;i<office.length;i++){for(var v=office[i],point=[],point2=[],i2=0;i2<v.point.length;i2++){var head="Пункт выдачи",hint="",ico_map=v.company_id,ico='<img class="edost_ico edost_ico_small rbs-fix-ico-edost" src="'+ico_path+"small/"+v.ico+'.gif" border="0">',detailed="",c=(v.point[i2].cod&&!cod_tariff?"возможна оплата за заказ при получении":"")+(v.point[i2].cod&&!cod_tariff&&null!=v.codplus_max&&0!=v.codplus_max[1]?"%codplus%":""),payment=v.codplus_max?c.replace(/%codplus%/g," (+ "+v.codplus_max[1]+")"):"",payment2=v.codplus_max?c.replace(/%codplus%/g,"<br>+ "+v.codplus_max[1]):"";"s"==v.company_id.substr(0,1)&&(ico_map=0,"Самовывоз"!=v.company.substr(0,9)&&"shop"!=v.format||(v.company="")),"shop"==v.format&&(head="Магазин"),"terminal"==v.format&&(head="Терминал ТК"),26!=v.company_id||5!=v.point[i2].type&&6!=v.point[i2].type||(head="Постамат",ico_map+="-2",hint='&nbsp;<a href="'+protocol+'pickpoint.ru/faq/?category=5" target="_blank"><img class="edost_ico edost_hint" src="'+protocol+'edostimg.ru/img/hint/hint_grey.gif"></a>',""!=payment&&(payment+="<br>наличными или банковской картой Visa и MasterCard",payment2+="<br>наличными или банковской картой Visa и MasterCard")),72!=v.company_id||5!=v.point[i2].type&&6!=v.point[i2].type||(head="Почтомат",ico_map+="-2",hint='&nbsp;<a href="'+protocol+'inpost.ru/ru/customers/kak-poluchit-zakaz" target="_blank"><img class="edost_ico edost_hint" src="'+protocol+'edostimg.ru/img/hint/hint_grey.gif"></a>'),""!=payment&&(payment='<div class="edost_payment edost_balloon_payment">'+payment+"</div>",payment2='<div class="edost_payment edost_balloon_payment">'+payment2+"</div>");var button=v.button.replace(/%office%/g,v.point[i2].id),button2=v.button2.replace(/%office%/g,v.point[i2].id),button2_info=v.button2_info.replace(/%office%/g,v.point[i2].id),ico_price=0==v.price_min[1]?free_ico:v.price_min[1];v.bold&&(ico_price="<b>"+ico_price+"</b>");var font_size=v.company.length>=11?' style="font-size: 13px;"':"",icoHref=protocol+"edostimg.ru/img/companymap/"+ico_map+".png",additionalClass="";"shop"==v.format&&(icoHref="/local/templates/romza_bitronic2_2.23.10/components/bitrix/sale.order.ajax/sib_order_new/images/sibico.jpg",additionalClass="rbs-root-point",ico='<img class="rbs-ico-shop rbs-fix-ico-edost" src="'+icoHref+'" border="0">');var descriptionAll='<div class="rbs-edost-fix">'+ico+"г. "+BX.Sale.OrderAjaxComponent.cityDeliveryName+"<br>"+v.point[i2].address+"</div>",icon={iconImageHref:icoHref,iconImageSize:[36,36],iconImageOffset:[-12,-36]};api21&&(icon.iconLayout="default#image");var s='<span class="edost_name"'+font_size+">"+head+" "+v.company+"</span>"+hint+"<br>"+(""!=v.point[i2].name?v.point[i2].name+"<br>":"")+descriptionAll+" "+detailed,placemark=new ymaps.Placemark([v.point[i2].gps[1],v.point[i2].gps[0]],{balloonContent:'<div class="edost_balloon"><div class="edost_balloon_schedule"'+font_size+">"+v.point[i2].schedule+"</div>"+s+payment+button+"</div>",iconContent:'<div class="edost_ico_price '+additionalClass+" rbs-point-"+v.point[i2].id+'">'+ico_price+"</div>"},icon);if(placemark.properties.set("balloonContent2",s+'<div class="edost_balloon_schedule2">'+v.point[i2].schedule+"</div>"+payment2+button2+button2_info),null==v.point[i2].repeat)point.push(placemark);else{point2.push(placemark);var u=v.point[i2].repeat;if(null==repeat[u]){s=(""!=v.point[i2].name?v.point[i2].name+"<br>":"")+v.point[i2].address;var s2=s;v.point[i2].repeat_individual||(s+=" "+detailed,s2='<span class="edost_name">'+head+"</span><br>"+s+'<div class="edost_balloon_schedule2">'+v.point[i2].schedule+"</div>",s='<div class="edost_balloon_schedule">'+v.point[i2].schedule+'</div><span class="edost_name">'+head+"</span><br>"+s),repeat[u]={info:s,info2:s2,button:"",button2:"",point:v.point[i2],price_min:v.price_min,bold:v.bold}}v.bold&&(repeat[u].bold=v.bold),1*v.price_min[0]<1*repeat[u].price_min[0]&&(repeat[u].price_min=v.price_min);var s='<div class="edost_balloon_delimiter"></div>',s2='<div class="edost_balloon_delimiter2"></div>';if(v.point[i2].repeat_individual)s2+=ico+'<span class="edost_name"'+font_size+">"+head+" "+v.company+"</span>"+hint+"<br>"+(""!=detailed?'<div class="edost_balloon_detailed">'+detailed+"</div>":"")+'<div class="edost_balloon_schedule2">'+v.point[i2].schedule+"</div>"+payment2,s+='<div class="edost_balloon_schedule edost_balloon_schedule_individual"'+font_size+">"+v.point[i2].schedule+"</div>"+ico+'<span class="edost_name"'+font_size+">"+head+" "+v.company+"</span>"+hint+"<br>"+(""!=detailed?'<div class="edost_balloon_detailed">'+detailed+"</div>":"")+payment;else{var c='<span class="edost_day">служба доставки </span>'+ico+'<span class="edost_name">'+v.company+"</span>"+hint+"<br>";s+='<div class="edost_balloon_individual">'+c+payment+"</div>",s2+="<div>"+c+payment2+"</div>"}repeat[u].button+=s+button,repeat[u].button2+=s2+button2}}self.data[i].geo=new ymaps.Clusterer({preset:api21?"islands#invertedDarkBlueClusterIcons":"twirl#invertedBlueClusterIcons",groupByCoordinates:!1,clusterDisableClickZoom:!1,zoomMargin:100}),self.data[i].geo.add(point),self.data[i].geo.add(point2),geo.add(point)}for(var point=[],i=0;i<repeat.length;i++)if(null!=repeat[i]){var v=repeat[i],ico_price=0==v.price_min[1]?free_ico:v.price_min[1];v.bold&&(ico_price="<b>"+ico_price+"</b>");var icon={iconImageHref:protocol+"edostimg.ru/img/companymap/0.png",iconImageSize:[36,36],iconImageOffset:[-12,-36]};api21&&(icon.iconLayout="default#image");var placemark=new ymaps.Placemark([v.point.gps[1],v.point.gps[0]],{balloonContent:'<div class="edost_balloon">'+v.info+v.button+"</div>",iconContent:'<div class="edost_ico_price">'+ico_price+"</div>"},icon);placemark.properties.set("balloonContent2",v.info2+v.button2+tariff_info),placemark.events.add("balloonopen",function(e){self.balloon(e)}),point.push(placemark)}geo.add(point),self.set_map("all")}if(self.fit(),null!=self.timer_resize&&window.clearInterval(self.timer_resize),self.timer_resize=window.setInterval(name+'.fit("resize")',400),self.map);else{var E=document.getElementById("edost_office_"+(self.inside?"inside":"window")+"_map");if(E){var s=loading;self.inside&&(window.edost_catalogdelivery&&""!=edost_catalogdelivery.loading?s=edost_catalogdelivery.loading:""!=self.loading_inside&&(s=self.loading_inside)),E.innerHTML=s,self.add_map()}}}}}},this.fit=function(param){var E=document.getElementById(self.inside?"edost_office_inside":"edost_office_window");if(E&&"none"!=E.style.display){var minWidth=900;if(window.innerWidth<1490&&window.innerWidth>768?minWidth-=1490-window.innerWidth:window.innerWidth<=768&&(minWidth=window.innerWidth-65),window.edostActiveId>0){var curPoint=$(".rbs-point-"+window.edostActiveId);curPoint.length&&(curPoint.closest(".ymaps-image-with-content").css({width:"50px",height:"50px",backgroundRepeat:"no-repeat",backgroundSize:"cover"}),curPoint.addClass("rbs-active-point"))}!$(".rbs-edost-map").hasClass("rbs-root-city")&&$(".rbs-root-point").length&&$(".rbs-root-point").closest(".rbs-edost-map").addClass("rbs-root-city");var browser_w=minWidth,browser_h=600;if(small_ico=browser_w<1100,small_ico=!1,"ico"!==param){if("resize"==param&&(0!=browser_width&&Math.abs(browser_width-browser_w)>100||0!=browser_height&&Math.abs(browser_height-600)>100))return format="",null!=self.timer_resize&&window.clearInterval(self.timer_resize),void self.window(param_start,onclose_set_office_start);if("resize"==param&&Math.abs(browser_width-browser_w)<20&&Math.abs(browser_height-600)<20){if(++update_number>2)return}else update_number=0;browser_width=browser_w,browser_height=600;var E2=document.getElementById("edost_office_"+(self.inside?"inside":"window")+"_head"),E3=document.getElementById("edost_office_"+(self.inside?"inside":"window")+"_map");if(E2&&E3){var window_w=E.offsetWidth,window_h=E.offsetHeight,head_h=E2.offsetHeight,max_w=browser_w-(small_ico?4:100);window_w=max_w,!small_ico&&window_w>1200&&(window_w=1200)>max_w&&(window_w=max_w),self.inside||(window_h=600-(small_ico?6:100),E.style.width=browser_w+"px",E.style.height=window_h+"px",E3.style.width="100%"),0!=window_h&&(E3.style.height=window_h-head_h-2+"px",self.map)}}}},this.set_map=function(n){if(null!=self.data){1==self.data.length&&(n="all"),api21&&self.map.geoObjects.removeAll();for(var point_count=0,i=0;i<self.data.length;i++){var show="all"==n||i==n,E;if((E=document.getElementById(name+"_price_td_"+i))&&(E.className="edost_active_"+(show?"on":"off")),show)if(point_count+=self.data[i].point.length,"all"==n)self.map.geoObjects.remove(self.data[i].geo);else{self.map.geoObjects.add(self.data[i].geo);var p=self.data[i].geo.getBounds();1==point_count?self.map.setCenter(p[0]):self.map.setBounds(p,{checkZoomRange:!1})}else self.map.geoObjects.remove(self.data[i].geo)}if("all"!=n)self.map.geoObjects.remove(geo);else{self.map.geoObjects.add(geo);var p=geo.getBounds();1==point_count?self.map.setCenter(p[0]):self.map.setBounds(p,{checkZoomRange:!1})}var E;(E=document.getElementById(name+"_price_td_all"))&&(E.style.display="all"==n||1==self.data.length?"none":"block");var currentPoint="";if(window.edostActiveId>0){var deliveryThis=BX.Sale.OrderAjaxComponent.getSelectedDelivery();deliveryThis&&deliveryThis.isEdostItem&&deliveryThis.office_data[window.edostActiveId]&&(currentPoint=(currentPoint=deliveryThis.office_data[window.edostActiveId].gps).split(","))}if(currentPoint&&(self.map.setCenter([currentPoint[1],currentPoint[0]]),point_count=1),1==point_count)self.map.setZoom(16);else{var z=self.map.getZoom();0==z&&(z=16),self.map.setZoom(z-1)}}},this.create_map=function(){var E;if(!self.map&&(E=document.getElementById("edost_office_"+(self.inside?"inside":"window")+"_map"))){E.innerHTML="",E.className="edost_map";var v={center:[0,0],zoom:12,type:"yandex#map",behaviors:["default","scrollZoom"]},E;if((api21=!!(window.ymaps&&window.ymaps.control&&window.ymaps.control.FullscreenControl))&&(v.controls=["zoomControl"]),self.map=new ymaps.Map("edost_office_"+(self.inside?"inside":"window")+"_map",v),"edost_office"==name&&(edost_map=self.map),api21||self.map.controls.add("zoomControl",{left:5,top:5}),self.isMobile&&(self.map.behaviors.disable("scrollZoom"),self.map.behaviors.disable("drag")),map_loading=!1,self.inside)(E=document.getElementById("edost_office_detailed"))&&(E.style.display="block");self.window("show","")}},this.add_map=function(){if(!map_loading){if(map_loading=!0,!window.ymaps){var E=document.body,E2=document.createElement("SCRIPT");E2.type="text/javascript",E2.charset="utf-8",E2.src=protocol+"api-maps.yandex.ru/"+("android"==edost_resize.os?"2.1.50":"2.0-stable")+"/?load=package.standard,package.clusters&apikey=5683d596-fa7a-45d6-96bf-fdc4f95c1e67&lang=ru-RU",E.appendChild(E2)}window.ymaps?ymaps.ready(self.create_map):(null!=self.timer&&window.clearInterval(self.timer),self.timer=window.setInterval("if (window.ymaps) { window.clearInterval("+name+".timer); ymaps.ready("+name+".create_map); }",500))}},this.balloon=function(param){var E;if("close"===param&&(edost_office_c.map&&edost_office_c.map.balloon.isOpen()&&edost_office_c.map.balloon.close(),edost_office2_c.map&&edost_office2_c.map.balloon.isOpen()&&edost_office2_c.map.balloon.close()),E=document.getElementById("edost_office_balloon"))if("close"!==param){if(!(browser_width>500&&browser_height>400&&"phone"!=edost_resize.device)){E.style.display="block";var s=param.get("target").properties.get("balloonContent2"),E;(E=document.getElementById("edost_office_balloon_data")).innerHTML=s}}else E.style.display="none"},this.info=function(param,link){var E;if(E=document.getElementById("edost_office_info"))if("close"!==param){link=null==link||""==link?protocol+"edost.ru/office.php?c="+param:link.replace(/%id%/g,param);var blank="blank"===param,E;if(blank){var E2=document.getElementById("edost_office_info_iframe");if(!E2)return;link=E2.src.replace(/map=N/g,"print=Y"),self.info("close")}if(""==edost_resize.device&&browser_width>500&&browser_height>400||blank)window.open(link,"_blank");else E.style.display="block",(E=document.getElementById("edost_office_info_data")).innerHTML='<iframe id="edost_office_info_iframe" name="edost_office_info_iframe" src="'+link+(-1===link.indexOf("?")?"?":"&")+'window=N&map=N" frameborder="0" width="100%" height="'+(edost_resize.browser_height-80)+'"></iframe>'}else E.style.display="none"}},edost_office_c=new edost_office_create_c("edost_office_c"),edostActiveId=BX.getCookie("edostActiveId")?BX.getCookie("edostActiveId"):0;function edost_SetOffice_c(profile,id,cod,mode){var E=document.getElementById("edost_office");E&&(E.value=id),id&&(window.edostActiveId=id,BX.setCookie("edostActiveId",id,{expires:86400})),edost_office_c.map&&edost_office_c.map.balloon.close()}